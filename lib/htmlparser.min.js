(function(){function x(){return((typeof require)=="function"&&(typeof exports)=="object"&&(typeof module)=="object"&&(typeof __filename)=="string"&&(typeof __dirname)=="string")}if(!x()){if(!this.Tautologistics){this.Tautologistics={}}else{if(this.Tautologistics.NodeHtmlParser){return}}this.Tautologistics.NodeHtmlParser={};exports=this.Tautologistics.NodeHtmlParser}var j={Text:"text",Directive:"directive",Comment:"comment",Script:"script",Style:"style",Tag:"tag"};function a(J,I){this._options=I?I:{};if(this._options.includeLocation==undefined){this._options.includeLocation=false}this.validateHandler(J);this._handler=J;this.reset()}a._reTrim=/(^\s+|\s+$)/g;a._reTrimComment=/(^\!--|--$)/g;a._reWhitespace=/\s/g;a._reTagName=/^\s*(\/?)\s*([^\s\/]+)/;a._reAttrib=/([^=<>\"\'\s]+)\s*=\s*"([^"]*)"|([^=<>\"\'\s]+)\s*=\s*'([^']*)'|([^=<>\"\'\s]+)\s*=\s*([^'"\s]+)|([^=<>\"\'\s\/]+)/g;a._reTags=/[\<\>]/g;a.prototype.parseComplete=function d(I){this.reset();this.parseChunk(I);this.done()};a.prototype.parseChunk=function f(I){if(this._done){this.handleError(new Error("Attempted to parse chunk after parsing already done"))}this._buffer+=I;this.parseTags()};a.prototype.done=function D(){if(this._done){return}this._done=true;if(this._buffer.length){var J=this._buffer;this._buffer="";var I={raw:J,data:(this._parseState==j.Text)?J:J.replace(a._reTrim,""),type:this._parseState};if(this._parseState==j.Tag||this._parseState==j.Script||this._parseState==j.Style){I.name=this.parseTagName(I.data)}this.parseAttribs(I);this._elements.push(I)}this.writeHandler();this._handler.done()};a.prototype.reset=function c(){this._buffer="";this._done=false;this._elements=[];this._elementsCurrent=0;this._current=0;this._next=0;this._location={row:0,col:0,charOffset:0,inBuffer:0,character:0};this._parseState=j.Text;this._prevTagSep="";this._tagStack=[];this._handler.reset()};a.prototype._options=null;a.prototype._handler=null;a.prototype._buffer=null;a.prototype._done=false;a.prototype._elements=null;a.prototype._elementsCurrent=0;a.prototype._current=0;a.prototype._next=0;a.prototype._location=null;a.prototype._parseState=j.Text;a.prototype._prevTagSep="";a.prototype._tagStack=null;a.prototype.parseTagAttribs=function v(L){var J=L.length;var I=0;while(I<J){var K=L[I++];if(K.type==j.Tag||K.type==j.Script||K.type==j.style){this.parseAttribs(K)}}return(L)};a.prototype.parseAttribs=function q(L){if(L.type!=j.Script&&L.type!=j.Style&&L.type!=j.Tag){return}var K=L.data.split(a._reWhitespace,1)[0];var I=L.data.substring(K.length);if(I.length<1){return}var J;a._reAttrib.lastIndex=0;while(J=a._reAttrib.exec(I)){if(L.attribs==undefined){L.attribs={}}if(typeof J[1]=="string"&&J[1].length){L.attribs[J[1]]=J[2]}else{if(typeof J[3]=="string"&&J[3].length){L.attribs[J[3].toString()]=J[4].toString()}else{if(typeof J[5]=="string"&&J[5].length){L.attribs[J[5]]=J[6]}else{if(typeof J[7]=="string"&&J[7].length){L.attribs[J[7]]=J[7]}}}}}};a.prototype.parseTagName=function e(J){if(J==null||J==""){return("")}var I=a._reTagName.exec(J);if(!I){return("")}return((I[1]?"/":"")+I[2])};a.prototype.parseTags=function u(){var N=this._buffer.length-1;while(a._reTags.test(this._buffer)){this._next=a._reTags.lastIndex-1;var L=this._buffer.charAt(this._next);var P=this._buffer.substring(this._current,this._next);var K={raw:P,data:(this._parseState==j.Text)?P:P.replace(a._reTrim,""),type:this._parseState};var I=this.parseTagName(K.data);if(this._tagStack.length){if(this._tagStack[this._tagStack.length-1]==j.Script){if(I.toLowerCase()=="/script"){this._tagStack.pop()}else{if(K.raw.indexOf("!--")!=0){K.type=j.Text;if(this._elements.length&&this._elements[this._elements.length-1].type==j.Text){var J=this._elements[this._elements.length-1];J.raw=J.data=J.raw+this._prevTagSep+K.raw;K.raw=K.data=""}}}}else{if(this._tagStack[this._tagStack.length-1]==j.Style){if(I.toLowerCase()=="/style"){this._tagStack.pop()}else{if(K.raw.indexOf("!--")!=0){K.type=j.Text;if(this._elements.length&&this._elements[this._elements.length-1].type==j.Text){var J=this._elements[this._elements.length-1];if(K.raw!=""){J.raw=J.data=J.raw+this._prevTagSep+K.raw;K.raw=K.data=""}else{J.raw=J.data=J.raw+this._prevTagSep}}else{if(K.raw!=""){K.raw=K.data=K.raw}}}}}else{if(this._tagStack[this._tagStack.length-1]==j.Comment){var O=K.raw.length;if(K.raw.charAt(O-2)=="-"&&K.raw.charAt(O-1)=="-"&&L==">"){this._tagStack.pop();if(this._elements.length&&this._elements[this._elements.length-1].type==j.Comment){var J=this._elements[this._elements.length-1];J.raw=J.data=(J.raw+K.raw).replace(a._reTrimComment,"");K.raw=K.data="";K.type=j.Text}else{K.type=j.Comment}}else{K.type=j.Comment;if(this._elements.length&&this._elements[this._elements.length-1].type==j.Comment){var J=this._elements[this._elements.length-1];J.raw=J.data=J.raw+K.raw+L;K.raw=K.data="";K.type=j.Text}else{K.raw=K.data=K.raw+L}}}}}}if(K.type==j.Tag){K.name=I;var M=I.toLowerCase();if(K.raw.indexOf("!--")==0){K.type=j.Comment;delete K.name;var O=K.raw.length;if(K.raw.charAt(O-1)=="-"&&K.raw.charAt(O-2)=="-"&&L==">"){K.raw=K.data=K.raw.replace(a._reTrimComment,"")}else{K.raw+=L;this._tagStack.push(j.Comment)}}else{if(K.raw.indexOf("!")==0||K.raw.indexOf("?")==0){K.type=j.Directive}else{if(M=="script"){K.type=j.Script;if(K.data.charAt(K.data.length-1)!="/"){this._tagStack.push(j.Script)}}else{if(M=="/script"){K.type=j.Script}else{if(M=="style"){K.type=j.Style;if(K.data.charAt(K.data.length-1)!="/"){this._tagStack.push(j.Style)}}else{if(M=="/style"){K.type=j.Style}}}}}}if(K.name&&K.name.charAt(0)=="/"){K.data=K.name}}if(K.raw!=""||K.type!=j.Text){if(this._options.includeLocation&&!K.location){K.location=this.getLocation(K.type==j.Tag)}this.parseAttribs(K);this._elements.push(K);if(K.type!=j.Text&&K.type!=j.Comment&&K.type!=j.Directive&&K.data.charAt(K.data.length-1)=="/"){this._elements.push({raw:"/"+K.name,data:"/"+K.name,name:"/"+K.name,type:K.type})}}this._parseState=(L=="<")?j.Tag:j.Text;this._current=this._next+1;this._prevTagSep=L}if(this._options.includeLocation){this.getLocation();this._location.row+=this._location.inBuffer;this._location.inBuffer=0;this._location.charOffset=0}this._buffer=(this._current<=N)?this._buffer.substring(this._current):"";this._current=0;this.writeHandler()};a.prototype.getLocation=function k(L){var M,J=this._location,I=this._current-(L?1:0),K=L&&J.charOffset==0&&this._current==0;for(;J.charOffset<I;J.charOffset++){M=this._buffer.charAt(J.charOffset);J.character++;if(M=="\n"){J.inBuffer++;J.col=0}else{if(M!="\r"){J.col++}}}return{line:J.row+J.inBuffer+1,col:J.col+(K?0:1),character:J.character-(K?1:0)}};a.prototype.validateHandler=function g(I){if((typeof I)!="object"){throw new Error("Handler is not an object")}if((typeof I.reset)!="function"){throw new Error("Handler method 'reset' is invalid")}if((typeof I.done)!="function"){throw new Error("Handler method 'done' is invalid")}if((typeof I.writeTag)!="function"){throw new Error("Handler method 'writeTag' is invalid")}if((typeof I.writeText)!="function"){throw new Error("Handler method 'writeText' is invalid")}if((typeof I.writeComment)!="function"){throw new Error("Handler method 'writeComment' is invalid")}if((typeof I.writeDirective)!="function"){throw new Error("Handler method 'writeDirective' is invalid")}};a.prototype.writeHandler=function i(J){J=!!J;if(this._tagStack.length&&!J){return}while(this._elements.length){var I=this._elements.shift();switch(I.type){case j.Comment:this._handler.writeComment(I);break;case j.Directive:this._handler.writeDirective(I);break;case j.Text:this._handler.writeText(I);break;default:this._handler.writeTag(I);break}}};a.prototype.handleError=function y(I){if((typeof this._handler.error)=="function"){this._handler.error(I)}else{throw I}};function l(I){l.super_.call(this,I,{ignoreWhitespace:true,verbose:false,enforceEmptyTags:false})}m(l,h);l.prototype.done=function H(){var K={};var L;var J=z.getElementsByTagName(function(M){return(M=="rss"||M=="feed")},this.dom,false);if(J.length){L=J[0]}if(L){if(L.name=="rss"){K.type="rss";L=L.children[0];K.id="";try{K.title=z.getElementsByTagName("title",L.children,false)[0].children[0].data}catch(I){}try{K.link=z.getElementsByTagName("link",L.children,false)[0].children[0].data}catch(I){}try{K.description=z.getElementsByTagName("description",L.children,false)[0].children[0].data}catch(I){}try{K.updated=new Date(z.getElementsByTagName("lastBuildDate",L.children,false)[0].children[0].data)}catch(I){}try{K.author=z.getElementsByTagName("managingEditor",L.children,false)[0].children[0].data}catch(I){}K.items=[];z.getElementsByTagName("item",L.children).forEach(function(P,M,Q){var O={};try{O.id=z.getElementsByTagName("guid",P.children,false)[0].children[0].data}catch(N){}try{O.title=z.getElementsByTagName("title",P.children,false)[0].children[0].data}catch(N){}try{O.link=z.getElementsByTagName("link",P.children,false)[0].children[0].data}catch(N){}try{O.description=z.getElementsByTagName("description",P.children,false)[0].children[0].data}catch(N){}try{O.pubDate=new Date(z.getElementsByTagName("pubDate",P.children,false)[0].children[0].data)}catch(N){}K.items.push(O)})}else{K.type="atom";try{K.id=z.getElementsByTagName("id",L.children,false)[0].children[0].data}catch(I){}try{K.title=z.getElementsByTagName("title",L.children,false)[0].children[0].data}catch(I){}try{K.link=z.getElementsByTagName("link",L.children,false)[0].attribs.href}catch(I){}try{K.description=z.getElementsByTagName("subtitle",L.children,false)[0].children[0].data}catch(I){}try{K.updated=new Date(z.getElementsByTagName("updated",L.children,false)[0].children[0].data)}catch(I){}try{K.author=z.getElementsByTagName("email",L.children,true)[0].children[0].data}catch(I){}K.items=[];z.getElementsByTagName("entry",L.children).forEach(function(P,M,Q){var O={};try{O.id=z.getElementsByTagName("id",P.children,false)[0].children[0].data}catch(N){}try{O.title=z.getElementsByTagName("title",P.children,false)[0].children[0].data}catch(N){}try{O.link=z.getElementsByTagName("link",P.children,false)[0].attribs.href}catch(N){}try{O.description=z.getElementsByTagName("summary",P.children,false)[0].children[0].data}catch(N){}try{O.pubDate=new Date(z.getElementsByTagName("updated",P.children,false)[0].children[0].data)}catch(N){}K.items.push(O)})}this.dom=K}l.super_.prototype.done.call(this)};function h(J,I){this.reset();this._options=I?I:{};if(this._options.ignoreWhitespace==undefined){this._options.ignoreWhitespace=false}if(this._options.verbose==undefined){this._options.verbose=true}if(this._options.enforceEmptyTags==undefined){this._options.enforceEmptyTags=true}if((typeof J)=="function"){this._callback=J}}h._emptyTags={area:1,base:1,basefont:1,br:1,col:1,frame:1,hr:1,img:1,input:1,isindex:1,link:1,meta:1,param:1,embed:1};h.reWhitespace=/^\s*$/;h.prototype.dom=null;h.prototype.reset=function E(){this.dom=[];this._done=false;this._tagStack=[];this._tagStack.last=function I(){return(this.length?this[this.length-1]:null)}};h.prototype.done=function t(){this._done=true;this.handleCallback(null)};h.prototype.writeTag=function C(I){this.handleElement(I)};h.prototype.writeText=function G(I){if(this._options.ignoreWhitespace){if(h.reWhitespace.test(I.data)){return}}this.handleElement(I)};h.prototype.writeComment=function s(I){this.handleElement(I)};h.prototype.writeDirective=function B(I){this.handleElement(I)};h.prototype.error=function r(I){this.handleCallback(I)};h.prototype._options=null;h.prototype._callback=null;h.prototype._done=false;h.prototype._tagStack=null;h.prototype.handleCallback=function A(I){if((typeof this._callback)!="function"){if(I){throw I}else{return}}this._callback(I,this.dom)};h.prototype.isEmptyTag=function(J){var I=J.name.toLowerCase();if(I.charAt(0)=="/"){I=I.substring(1)}return this._options.enforceEmptyTags&&!!h._emptyTags[I]};h.prototype.handleElement=function o(I){if(this._done){this.handleCallback(new Error("Writing to the handler after done() called is not allowed without a reset()"))}if(!this._options.verbose){delete I.raw;if(I.type=="tag"||I.type=="script"||I.type=="style"){delete I.data}}if(!this._tagStack.last()){if(I.type!=j.Text&&I.type!=j.Comment&&I.type!=j.Directive){if(I.name.charAt(0)!="/"){this.dom.push(I);if(!this.isEmptyTag(I)){this._tagStack.push(I)}}}else{this.dom.push(I)}}else{if(I.type!=j.Text&&I.type!=j.Comment&&I.type!=j.Directive){if(I.name.charAt(0)=="/"){var J=I.name.substring(1);if(!this.isEmptyTag(I)){var K=this._tagStack.length-1;while(K>-1&&this._tagStack[K--].name!=J){}if(K>-1||this._tagStack[0].name==J){while(K<this._tagStack.length-1){this._tagStack.pop()}}}}else{if(!this._tagStack.last().children){this._tagStack.last().children=[]}this._tagStack.last().children.push(I);if(!this.isEmptyTag(I)){this._tagStack.push(I)}}}else{if(!this._tagStack.last().children){this._tagStack.last().children=[]}this._tagStack.last().children.push(I)}}};var z={testElement:function n(I,K){if(!K){return false}for(var J in I){if(J=="tag_name"){if(K.type!="tag"&&K.type!="script"&&K.type!="style"){return false}if(!I.tag_name(K.name)){return false}}else{if(J=="tag_type"){if(!I.tag_type(K.type)){return false}}else{if(J=="tag_contains"){if(K.type!="text"&&K.type!="comment"&&K.type!="directive"){return false}if(!I.tag_contains(K.data)){return false}}else{if(!K.attribs||!I[J](K.attribs[J])){return false}}}}}return true},getElements:function F(Q,M,I,J){I=(I===undefined||I===null)||!!I;J=isNaN(parseInt(J))?-1:parseInt(J);if(!M){return([])}var P=[];var L;function N(R){return(function(S){return(S==R)})}for(var O in Q){if((typeof Q[O])!="function"){Q[O]=N(Q[O])}}if(z.testElement(Q,M)){P.push(M)}if(J>=0&&P.length>=J){return(P)}if(I&&M.children){L=M.children}else{if(M instanceof Array){L=M}else{return(P)}}for(var K=0;K<L.length;K++){P=P.concat(z.getElements(Q,L[K],I,J));if(J>=0&&P.length>=J){break}}return(P)},getElementById:function b(L,J,K){var I=z.getElements({id:L},J,K,1);return(I.length?I[0]:null)},getElementsByTagName:function p(K,J,L,I){return(z.getElements({tag_name:K},J,L,I))},getElementsByTagType:function w(K,J,L,I){return(z.getElements({tag_type:K},J,L,I))}};function m(J,I){var K=function(){};K.prototype=I.prototype;J.super_=I;J.prototype=new K();J.prototype.constructor=J}exports.Parser=a;exports.DefaultHandler=h;exports.RssHandler=l;exports.ElementType=j;exports.DomUtils=z})();